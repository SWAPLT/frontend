<div class="container">
  <h2>Gestión de Vehículos</h2>

  <!-- Mensaje de error -->
  <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>

  <!-- Vista de listado -->
  <div *ngIf="formMode === 'list'">
    <div class="table-actions">
      <button (click)="showCreateForm()">Nuevo Vehículo</button>
      <button (click)="loadVehiculos()">Recargar Lista</button>
    </div>

    <div class="table-responsive" *ngIf="!isLoading && vehiculos.length > 0">
      <table>
        <thead>
        <tr>
          <th>Propietario</th>
          <th>Marca</th>
          <th>Modelo</th>
          <th>Año</th>
          <th>Precio</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let vehiculo of vehiculos">
          <td>{{ getNombreUsuario(vehiculo.user_id) }}</td>
          <td>{{ vehiculo.marca }}</td>
          <td>{{ vehiculo.modelo }}</td>
          <td>{{ vehiculo.anio }}</td>
          <td>{{ vehiculo.precio | currency }}</td>

          <td>
            <span [class.estado-nuevo]="vehiculo.estado === 'nuevo'"
                  [class.estado-usado]="vehiculo.estado === 'usado'">
                  {{ vehiculo.estado }}
            </span>
          </td>

          <td class="action-buttons">
            <button (click)="showEditForm(vehiculo)">Editar</button>
            <button (click)="deleteVehiculo(vehiculo.id)">Eliminar</button>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="!isLoading && vehiculos.length === 0" class="no-data">
      No hay vehículos disponibles.
    </div>

    <div *ngIf="isLoading" class="loading">
      Cargando vehículos...
    </div>
  </div>

  <!-- Vista del formulario (crear o editar) -->
  <div *ngIf="formMode === 'create' || formMode === 'edit'">
    <h3 *ngIf="formMode === 'create'">Crear Vehículo</h3>
    <h3 *ngIf="formMode === 'edit'">Editar Vehículo</h3>
    <form [formGroup]="vehiculoForm" (ngSubmit)="submitForm()">
      <div class="form-grid">
        <div class="form-group">
          <label>Propietario:</label>
          <select formControlName="user_id">
            <option *ngFor="let user of usuarios" [value]="user.id">{{ user.name }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Categoria ID:</label>
          <input formControlName="categoria_id" type="number" />
        </div>
        <div class="form-group">
          <label>Marca:</label>
          <input formControlName="marca" type="text" />
        </div>
        <div class="form-group">
          <label>Modelo:</label>
          <input formControlName="modelo" type="text" />
        </div>
        <div class="form-group">
          <label>Precio:</label>
          <input formControlName="precio" type="number" step="0.01"/>
        </div>
        <div class="form-group">
          <label>Año:</label>
          <input formControlName="anio" type="number"/>
        </div>
        <div class="form-group">
          <label>Estado:</label>
          <select formControlName="estado">
            <option value="nuevo">Nuevo</option>
            <option value="usado">Usado</option>
          </select>
        </div>
        <div class="form-group">
          <label>Transmisión:</label>
          <select formControlName="transmision">
            <option value="manual">Manual</option>
            <option value="automatica">Automática</option>
            <option value="cvt">CVT</option>
            <option value="semi-automatica">Semi-automática</option>
          </select>
        </div>
        <div class="form-group">
          <label>Tipo de Combustible:</label>
          <select formControlName="tipo_combustible">
            <option value="gasolina">Gasolina</option>
            <option value="diesel">Diésel</option>
            <option value="electrico">Eléctrico</option>
            <option value="hibrido">Híbrido</option>
            <option value="gas">Gas (GLP/GNC)</option>
          </select>
        </div>
        <div class="form-group">
          <label>Kilometraje:</label>
          <input formControlName="kilometraje" type="number" />
        </div>
        <div class="form-group">
          <label>Fuerza:</label>
          <input formControlName="fuerza" type="number" />
        </div>
        <div class="form-group">
          <label>Capacidad del Motor:</label>
          <select formControlName="capacidad_motor">
            <option value="0.8">0.8</option>
            <option value="1.0">1.0</option>
            <option value="1.2">1.2</option>
            <option value="1.3">1.3</option>
            <option value="1.4">1.4</option>
            <option value="1.5">1.5</option>
            <option value="1.6">1.6</option>
            <option value="1.8">1.8</option>
            <option value="1.9">1.9</option>
            <option value="2.0">2.0</option>
            <option value="2.2">2.2</option>
            <option value="2.4">2.4</option>
            <option value="2.5">2.5</option>
            <option value="2.8">2.8</option>
            <option value="3.0">3.0</option>
            <option value="3.5">3.5</option>
            <option value="4.0">4.0</option>
            <option value="4.5">4.5</option>
            <option value="5.0">5.0</option>
            <option value="6.0">6.0</option>
            <option value="6.5">6.5</option>
            <option value="7.0">7.0</option>
          </select>
        </div>
        <div class="form-group">
          <label>Color:</label>
          <input formControlName="color" type="text" />
        </div>
        <div class="form-group">
          <label>Ubicación:</label>
          <input formControlName="ubicacion" type="text" />
        </div>
        <div class="form-group">
          <label>Matrícula:</label>
          <input formControlName="matricula" type="text" />
        </div>
        <div class="form-group">
          <label>Número de Serie:</label>
          <input formControlName="numero_serie" type="text" />
        </div>
        <div class="form-group">
          <label>Número de Puertas:</label>
          <select formControlName="numero_puertas">
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </div>
        <div class="form-group full-width">
          <label>Descripción:</label>
          <textarea formControlName="descripcion"></textarea>
        </div>
        <div class="form-group">
          <label>Vehículo Robado:</label>
          <select formControlName="vehiculo_robado">
            <option value="no">No</option>
            <option value="si">Sí</option>
          </select>
        </div>
        <div class="form-group">
          <label>Vehículo Libre de Accidentes:</label>
          <select formControlName="vehiculo_libre_accidentes">
            <option value="si">Sí</option>
            <option value="no">No</option>
          </select>
        </div>
        <div class="form-actions full-width">
          <button type="submit">
            {{ formMode === 'create' ? 'Crear Vehículo' : 'Actualizar Vehículo' }}
          </button>
          <button type="button" (click)="cancelForm()">Cancelar</button>
        </div>
      </div>
    </form>
  </div>
</div>
