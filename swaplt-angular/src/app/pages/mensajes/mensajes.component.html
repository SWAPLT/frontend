<div class="chat-container">
  <!-- Lista de chats -->
  <div class="chat-list" [class.active]="!mostrarChat">
    <div class="chat-header">
      <h2>Mensajes</h2>
    </div>
    <div class="chat-users">
      <ng-container *ngFor="let usuario of usuarios">
        <div class="user-item" 
             [class.active]="usuarioSeleccionado?.id === usuario.id"
             (click)="seleccionarUsuario(usuario.id)"
             *ngIf="tieneConversacion(usuario.id)">
          <div class="user-avatar">
            <span class="avatar-icon">👤</span>
          </div>
          <div class="user-info">
            <div class="user-name">
              <span>{{ usuario.name }}</span>
              <span class="unread-indicator" *ngIf="tieneMensajesNoLeidos(usuario.id)"></span>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>

  <!-- Área de chat -->
  <div class="chat-area" *ngIf="usuarioSeleccionado" [class.active]="mostrarChat">
    <div class="chat-header">
      <button class="back-to-list" (click)="volverALista()">
        <i class="fas fa-chevron-left"></i>
      </button>
      <div class="chat-user-info">
        <div class="user-avatar">
          <span class="avatar-icon">👤</span>
        </div>
        <div class="user-details">
          <h3>{{ usuarioSeleccionado.name }}</h3>
          <div class="user-email">{{ usuarioSeleccionado.email }}</div>
        </div>
      </div>
    </div>
    
    <div class="messages-container">
      <div *ngFor="let mensaje of mensajes" 
           [class.message-sent]="esMensajePropio(mensaje)"
           [class.message-received]="!esMensajePropio(mensaje)"
           (contextmenu)="mostrarMenuContextual($event, mensaje)"
           [id]="'mensaje-' + mensaje.id">
        <div class="message-content">
          {{ mensaje.contenido }}
        </div>
        <div class="message-time">
          {{ mensaje.created_at | date:'shortTime' }}
          <span *ngIf="esMensajePropio(mensaje) && mensaje.leido" class="read-status">✓✓</span>
        </div>
      </div>
    </div>

    <!-- Menú contextual -->
    <div class="context-menu" 
         [style.display]="menuContextual.mostrar ? 'block' : 'none'"
         [style.left.px]="menuContextual.x"
         [style.top.px]="menuContextual.y">
      <div class="menu-item estado-lectura" *ngIf="menuContextual.mensaje && esMensajePropio(menuContextual.mensaje)">
        <i class="fas" [class.fa-check-double]="menuContextual.mensaje.leido" [class.fa-check]="!menuContextual.mensaje.leido"></i>
        {{ menuContextual.mensaje.leido ? 'Leído' : 'No leído' }}
      </div>
      <div class="menu-item eliminar" *ngIf="menuContextual.mensaje" (click)="eliminarMensaje(menuContextual.mensaje)">
        <i class="fas fa-trash"></i> Eliminar mensaje
      </div>
    </div>

    <div class="message-input">
      <input type="text" 
             [(ngModel)]="nuevoMensaje" 
             placeholder="Escribe un mensaje..."
             (keyup.enter)="enviarMensaje()">
      <button (click)="enviarMensaje()" [disabled]="!nuevoMensaje.trim()">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>

  <!-- Vista cuando no hay chat seleccionado -->
  <div class="no-chat-selected" *ngIf="!usuarioSeleccionado">
    <div class="empty-state">
      <img src="/assets/imgs/logo.png" alt="SWAPLT Logo" class="empty-logo">
      <h3>Selecciona un chat</h3>
      <p>Elige un usuario de la lista para comenzar a conversar</p>
    </div>
  </div>
</div> 