<div class="profile-container">
  <div class="profile-header">
    <h2 class="profile-title">
      <span class="profile-avatar">
        <img *ngIf="user?.avatar; else defaultAvatar" [src]="user.avatar" alt="Avatar" />
        <ng-template #defaultAvatar>
          <svg class="default-avatar-icon" viewBox="0 0 24 24">
            <path fill="#6c63ff" d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v3h20v-3c0-3.3-6.7-5-10-5z"/>
          </svg>
        </ng-template>
      </span>
      Perfil de Usuario
    </h2>
    <div class="profile-status" [class.verified]="user.email_verified_at">
      {{ user.email_verified_at ? 'Verificado ✓' : 'No verificado ✗' }}
    </div>
  </div>

  <div *ngIf="!isEditing" class="profile-details">
    <div class="detail-item">
      <span class="detail-label">Nombre:</span>
      <span class="detail-value">{{ user.name }}</span>
    </div>

    <div class="detail-item" *ngIf="valoracionMedia !== null">
      <span class="detail-label">Valoración media:</span>
      <span class="detail-value">
        <span class="rating-stars">
          <ng-container *ngFor="let star of [1,2,3,4,5]">
            <i class="fas" [ngClass]="star <= valoracionMedia ? 'fa-star' : (star - valoracionMedia < 1 && star - valoracionMedia > 0 ? 'fa-star-half-alt' : 'fa-star-o')"></i>
          </ng-container>
        </span>
        <span class="rating-value">{{ valoracionMedia | number:'1.1-2' }}/5</span>
        <span class="rating-count">({{ totalValoraciones }} valoraciones)</span>
      </span>
    </div>

    <div class="detail-item">
      <span class="detail-label">Email:</span>
      <span class="detail-value">{{ user.email }}</span>
    </div>

    <div class="detail-item">
      <span class="detail-label">Rol:</span>
      <span class="detail-value role-badge">
        {{ user.rol === 'admin' ? 'Administrador' : 'Particular' }}
      </span>
    </div>

    <!-- Botón de administración solo visible para admins -->
    <button *ngIf="isAdmin" (click)="goToAdminPanel()" class="admin-panel-button">Panel de Administración</button>

    <!-- Botón para ver mis vehículos -->
    <button (click)="goToMyVehicles()" class="my-vehicles-button">
      <i class="fas fa-car"></i> Mis Vehículos
    </button>

    <!-- Botón para usuarios bloqueados -->
    <div class="blocked-users-section">
      <button (click)="toggleUsuariosBloqueados()" class="my-vehicles-button blocked-users-button">        <i class="fas fa-ban"></i> Usuarios Bloqueados
        <span class="blocked-count" *ngIf="usuariosBloqueados.length > 0">
          ({{ usuariosBloqueados.length }})
        </span>
      </button>

      <!-- Lista de usuarios bloqueados -->
      <div *ngIf="mostrarUsuariosBloqueados" class="blocked-users-list">
        <div *ngIf="usuariosBloqueados.length === 0" class="no-blocked-users">
          No tienes usuarios bloqueados
        </div>
        <div *ngFor="let usuario of usuariosBloqueados" class="blocked-user-item">
          <div class="blocked-user-info">
            <span class="blocked-user-name">{{ usuario.name }}</span>
            <span class="blocked-user-email">{{ usuario.email }}</span>
          </div>
          <button (click)="desbloquearUsuario(usuario.id)" class="unblock-button">
            <i class="fas fa-unlock"></i> Desbloquear
          </button>
        </div>
      </div>
    </div>

    <button (click)="enableEdit()" class="edit-button">Editar Perfil</button>
  </div>

  <div *ngIf="isEditing" class="profile-edit-form">
    <form (ngSubmit)="updateProfile()" class="profile-form">
      <div class="form-group">
        <label for="name" class="form-label">Nombre</label>
        <input id="name" type="text" class="form-input" [(ngModel)]="userData.name" name="name" required />
      </div>

      <div class="form-group">
        <label for="email" class="form-label">Correo Electrónico</label>
        <input id="email" type="email" class="form-input" [(ngModel)]="userData.email" name="email" required />
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary">Actualizar</button>
        <button type="button" class="btn btn-secondary" (click)="cancelEdit()">Cancelar</button>
      </div>
    </form>
  </div>
</div>
