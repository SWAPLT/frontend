<div class="container">
  <!-- Estado de carga -->
  <div *ngIf="loading" class="loading">
    <div class="spinner-grow text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Mensaje de error -->
  <div *ngIf="error" class="error">
    <p>Error al cargar el perfil del usuario</p>
  </div>

  <!-- Perfil del usuario -->
  <div *ngIf="!loading && !error && usuario" class="profile-container">
    <!-- Información del usuario -->
    <div class="user-info-section">
      <div class="user-header">
        <div class="user-avatar">
          <i class="fas fa-user"></i>
        </div>
        <div class="user-details">
          <h1>{{ usuario.nombre }}</h1>
          <div class="user-rating-row">
            <div *ngIf="valoracionMedia !== null" class="user-rating">
              <span class="rating-stars">
                <ng-container *ngFor="let star of [1,2,3,4,5]">
                  <i class="fas" [ngClass]="star <= valoracionMedia ? 'fa-star' : (star - valoracionMedia < 1 && star - valoracionMedia > 0 ? 'fa-star-half-alt' : 'fa-star-o')"></i>
                </ng-container>
              </span>
              <span class="rating-value">{{ valoracionMedia | number:'1.1-2' }}/5</span>
              <span class="rating-count">({{ totalValoraciones }} valoraciones)</span>
            </div>
            <div *ngIf="puedeValorar && !valoracionEnviada" class="valorar-form">
              <form (ngSubmit)="enviarValoracion()">
                <label for="valoracion-select">Valorar:</label>
                <select id="valoracion-select" [(ngModel)]="valorSeleccionado" name="valor" required>
                  <option *ngFor="let v of [5,4,3,2,1]" [value]="v">{{v}} ⭐</option>
                </select>
                <input type="text" [(ngModel)]="comentario" name="comentario" maxlength="255" placeholder="Comentario (opcional)">
                <button type="submit">Enviar</button>
              </form>
              <div *ngIf="valoracionError" class="valoracion-error">{{ valoracionError }}</div>
            </div>
            <div *ngIf="valoracionEnviada" class="valoracion-enviada">¡Valoración enviada!</div>
          </div>
          <p class="user-email">{{ usuario.email }}</p>
          <p class="user-role">Rol: {{ usuario.rol }}</p>
          <p class="user-date">Miembro desde: {{ usuario.fecha_registro | date:'longDate' }}</p>
        </div>
      </div>
    </div>

    <!-- Vehículos del usuario -->
    <div class="vehicles-section">
      <h2>Vehículos Publicados ({{ vehiculos.length }})</h2>
      
      <div *ngIf="vehiculos.length === 0" class="no-vehicles">
        <i class="fas fa-car fa-3x"></i>
        <p>Este usuario aún no ha publicado ningún vehículo</p>
      </div>

      <div *ngIf="vehiculos.length > 0" class="vehicles-grid">
        <div *ngFor="let vehiculo of vehiculos" class="vehicle-card">
          <div class="vehicle-image">
            <img [src]="vehiculo.imagenes[0]?.preview_url || vehiculo.imagenes[0]?.url || '/assets/imgs/no-imagen.jpeg'" 
                 [alt]="vehiculo.marca + ' ' + vehiculo.modelo">
          </div>
          <div class="vehicle-info">
            <div class="vehicle-header">
              <h3>{{ vehiculo.marca }} {{ vehiculo.modelo }}</h3>
              <p class="vehicle-price">€{{ vehiculo.precio | number:'1.0-0' }}</p>
            </div>
            <div class="vehicle-details-centered">
              <div class="detail-item">
                <i class="fas fa-calendar"></i>
                <span>{{ vehiculo.anio }}</span>
              </div>
              <div class="detail-item">
                <i class="fas fa-tachometer-alt"></i>
                <span>{{ vehiculo.kilometraje | number }} km</span>
              </div>
              <div class="detail-item">
                <i class="fas fa-cog"></i>
                <span>{{ vehiculo.transmision }}</span>
              </div>
            </div>
            <div class="vehicle-footer">
              <button class="ver-detalles" [routerLink]="['/vehiculo', vehiculo.id]">
                <i class="fas fa-eye"></i> Ver Detalles
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="valoraciones.length > 0" class="valoraciones-section">
      <h2>Valoraciones recibidas</h2>
      <div class="valoracion-item" *ngFor="let v of valoraciones">
        <div class="valoracion-header">
          <span class="valoracion-stars">
            <ng-container *ngFor="let star of [1,2,3,4,5]">
              <i class="fas" [ngClass]="star <= v.valor ? 'fa-star' : 'fa-star-o'"></i>
            </ng-container>
          </span>
          <span class="valoracion-num">{{ v.valor }}/5</span>
          <span class="valoracion-emisor">
            de {{ v.emisor_nombre || ('usuario #' + v.emisor_id) }}
          </span>
        </div>
        <div class="valoracion-comentario" *ngIf="v.comentario">"{{ v.comentario }}"</div>
        <div class="valoracion-fecha">{{ v.created_at | date:'mediumDate' }}</div>
      </div>
    </div>
  </div>
</div> 